{extend name="layout/layout" /}
{block name="title"}{$article.title} - v2ex{/block}
{block name="main"}
<div class="box" style="border-bottom: 0px;">
    <div class="header">
        <div class="fr"><a href="/member/{$article.author.id}"><img
                src="{$article.author.avatar}"
                class="avatar" border="0" align="default" style="min-width: 73px;"></a></div>
        <a href="/">V2EX</a> <span class="chevron">&nbsp;›&nbsp;</span> <a
            href="#">{$article.category.name}</a>
        <div class="sep10"></div>
        <h1>{$article.title}</h1>
        <small class="gray"><a href="/member/{$article.author.id}">{$article.author.username}</a> ·
            {$article.create_date} ·
            {$article.visit} 次点击 &nbsp; </small>
    </div>


    <div class="cell">

        <div class="topic_content">{$article.content}
        </div>

    </div>
    <div class="topic_buttons">
        <div class="fr gray f11" style="line-height: 12px; padding-top: 3px; text-shadow: 0px 1px 0px #fff;">
            {$article.visit} 次点击 &nbsp;∙&nbsp; {$collectionCount}人收藏 &nbsp; </div>
        <form id="oneForm" method="post">
            <input type="hidden" name="articleId" id="articleId" value="{$article.id}">
            {if condition="$isCollection"}
            <a href="#" id="deleteArticle">取消收藏</a>
            {else /}
            <a href="#" id="addArticle">加入收藏</a>
            {/if}&nbsp;
        </form>
    </div>
</div>
<div class="sep20"></div>
<div class="box">
    {volist name='comments' id='comment'}
    <div id="r_{$comment.id}" class="cell normalUser">
        <table cellpadding="0" cellspacing="0" border="0" width="100%">
            <tbody>
            <tr>
                <td width="48" valign="top" align="center"><img src="{$comment.user.avatar}" class="avatar"
                                                                border="0" align="default"></td>
                <td width="10" valign="top"></td>
                <td width="auto" valign="top" align="left">
                    <div class="fr">
                        <div id="thank_area_4091610" class="thank_area">&nbsp; &nbsp; &nbsp; </div>
                        &nbsp;&nbsp; <span class="no">{$comment.number}</span></div>
                    <div class="sep3"></div>
                    <strong><a href="/member/{$comment.user.id}" class="dark">{$comment.user.username}</a></strong>&nbsp;
                    &nbsp;<span
                        class="fade small">{$comment.create_date}</span>
                    <div class="sep5"></div>
                    <div class="reply_content" style="white-space: pre-wrap;">{$comment.content}</div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    {/volist}
    {if condition="$Think.session.user != null"}
    <div class="cell">
        <form method="post" action="/comment/add">
        <textarea name="content" maxlength="10000" class="mll" id="reply_content"
                  style="resize: none; height: 112px; overflow: hidden; word-wrap: break-word;" placeholder="你可以在文本框内直接粘贴截图或拖拽图片上传
类似于 [:微笑:] 的图片标签可以优雅的移动"></textarea>
            <div class="sep10"></div>
            <div class="fr">
                <div class="sep5"></div>
                <span cl ass="gray">请尽量让自己的回复能够对别人有帮助</span></div>
            <input type="hidden" value="{$article.id}" name="articleId">
            <input type="submit" value="回复" class="super normal button">
        </form>
    </div>
    {/if}
</div>
<script>
    $("#deleteArticle").on("click", function () {
        $.ajax({
            url: "/index/collection/deleteArticle",
            method: "post",
            data: {
                "articleId": $("#articleId").val(),
            },
            success: function (data) {
                if (data.status == "error") {
                    // 更新失败
                    alert(data.message);
                } else if (data.status == "success") {
                    // 更新成成功
                    window.location.href = "/t/{$article.id}";
                } else {
                    alert("未知错误");
                }
            }
        });
    });
    $("#addArticle").on("click", function () {
        $.ajax({
            url: "/index/collection/addArticle",
            method: "post",
            data: {
                "articleId": $("#articleId").val(),
            },
            success: function (data) {
                if (data.status == "error") {
                    // 更新失败
                    alert(data.message);
                } else if (data.status == "success") {
                    // 更新成成功
                    window.location.href = "/t/{$article.id}";
                } else {
                    alert("未知错误");
                }
            }
        });
    });
</script>
{/block}